@page "/vault/{VaultId:int}"
@rendermode InteractiveServer
@using PassManGUI.Services
@using static PassManGUI.Services.MockDataService

@* 
    Vault Detail Page - Displays items within a specific vault
    
    TODO:
    1. Add authentication check
       - Redirect to /login if not authenticated
       - Verify user has access to this vault
    
    2. Load vault items from API
       - Call GET /api/vaults/{id}/items endpoint
       - Display loading state while fetching
       - Handle empty state (no items in vault)
    
    3. Implement item actions
       - Add new item (modal/page)
       - Edit item (modal/inline)
       - Delete item (confirmation dialog)
       - Copy password to clipboard
       - View password (toggle visibility)
    
    4. Add search/filter functionality
       - Search items by name/username
       - Filter by category/type
       - Sort options (name, date, etc.)
    
    5. Vault settings
       - Edit vault name/description
       - Delete vault
       - Share vault with users
       - Export vault data
*@

<PageTitle>@vaultName - PassMan</PageTitle>

<div class="page-grid">
    <div class="page-content">
        <div class="vault-detail-container">
            <!-- Header -->
            <div class="vault-detail-header">
                <div class="header-top">
                    <a href="/vaults" class="back-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Back to Vaults</span>
                    </a>
                </div>
                
                <div class="header-content">
                    <div class="header-left">
                        <div class="vault-info">
                            <h1>@vaultName</h1>
                            <p>@vaultDescription</p>
                        </div>
                    </div>
                    <div class="header-right">
                        <button class="btn-secondary">Vault Settings</button>
                        <button class="btn-primary" @onclick="AddItem">+ Add Item</button>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="vault-detail-content">
                @if (items.Count == 0)
                {
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                            <path d="M7 10V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V10M5 10H19C20.1046 10 21 10.8954 21 12V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V12C3 10.8954 3.89543 10 5 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h2>No items yet</h2>
                        <p>Add your first password or credential to this vault.</p>
                        <button class="btn-primary" @onclick="AddItem">Add Your First Item</button>
                    </div>
                }
                else
                {
                    <div class="items-container">
                        <p class="items-count">@items.Count items in this vault</p>
                        <div class="items-list">
                            @foreach (var item in items)
                            {
                                <ItemCard 
                                    Name="@item.Name"
                                    Username="@item.Username"
                                    Url="@item.Url"
                                    Label="@item.Label"
                                    CreatedAt="@item.CreatedAt"
                                    OnClick="() => OpenItem(item.Id)" />
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Item Detail Panel (outside page-grid for fixed positioning) -->
<ItemDetailPanel 
    IsOpen="isPanelOpen"
    ItemName="@selectedItemName"
    ItemUsername="@selectedItemUsername"
    ItemPassword="@selectedItemPassword"
    ItemUrl="@selectedItemUrl"
    ItemLabel="@selectedItemLabel"
    ItemNotes="@selectedItemNotes"
    ItemTags="@selectedItemTags"
    ItemCreatedAt="@selectedItemCreatedAt"
    ItemUpdatedAt="@selectedItemUpdatedAt"
    OnClose="ClosePanel"
    OnEdit="EditItem"
    OnDelete="DeleteItem" />

@code {
    [Parameter]
    public int VaultId { get; set; }
    
    private string vaultName = "";
    private string vaultDescription = "";
    private List<VaultItemModel> items = new();
    
    // Panel state
    private bool isPanelOpen = false;
    private int selectedItemId = 0;
    private string selectedItemName = "";
    private string selectedItemUsername = "";
    private string selectedItemPassword = "";
    private string selectedItemUrl = "";
    private string selectedItemLabel = "";
    private string selectedItemNotes = "";
    private string selectedItemTags = "";
    private string selectedItemCreatedAt = "";
    private string selectedItemUpdatedAt = "";
    
    protected override Task OnInitializedAsync()
    {
        // TODO: Replace with actual API calls
        // Load vault details: var vault = await VaultService.GetVaultAsync(VaultId);
        // Load vault items: items = await VaultService.GetVaultItemsAsync(VaultId);
        
        // Mock data based on VaultId
        LoadMockData();
        
        return Task.CompletedTask;
    }
    
    private void LoadMockData()
    {
        vaultName = MockDataService.GetVaultName(VaultId);
        vaultDescription = MockDataService.GetVaultDescription(VaultId);
        items = MockDataService.GetVaultItems(VaultId);
    }
    
    private void AddItem()
    {
        // TODO: Open add item modal or navigate to add page
        Console.WriteLine("Add item clicked");
    }
    
    private void OpenItem(int itemId)
    {
        // Load item details and open panel
        selectedItemId = itemId;
        LoadItemDetails(itemId);
        isPanelOpen = true;
    }
    
    private void LoadItemDetails(int itemId)
    {
        // TODO: Replace with actual API call to get full item details
        // For now, use mock data based on itemId
        
        selectedItemName = itemId switch
        {
            1 => "Gmail Account",
            2 => "GitHub",
            3 => "Netflix",
            4 => "Office 365",
            5 => "Slack",
            _ => "Unknown Item"
        };
        
        selectedItemUsername = itemId switch
        {
            1 => "john.doe@gmail.com",
            2 => "johndoe",
            3 => "john.doe@gmail.com",
            4 => "john.doe@company.com",
            5 => "john.doe@company.com",
            _ => ""
        };
        
        selectedItemPassword = "MySecurePassword123!"; // Mock password
        
        selectedItemUrl = itemId switch
        {
            1 => "https://mail.google.com",
            2 => "https://github.com",
            3 => "https://netflix.com",
            4 => "https://office.com",
            5 => "https://slack.com",
            _ => ""
        };
        
        selectedItemLabel = itemId switch
        {
            1 => "Personal",
            2 => "",
            3 => "Streaming",
            4 => "Work",
            5 => "",
            _ => ""
        };
        
        selectedItemNotes = itemId switch
        {
            1 => "Primary email account for personal use. Enable 2FA for extra security.",
            2 => "Development account with access to personal repositories.",
            3 => "Family streaming subscription - shared with household.",
            4 => "Corporate email and office suite access.",
            5 => "Company workspace communication tool.",
            _ => ""
        };
        
        selectedItemTags = itemId switch
        {
            1 => "email, google, primary",
            2 => "development, coding, git",
            3 => "streaming, entertainment, family",
            4 => "work, email, office",
            5 => "work, communication, team",
            _ => ""
        };
        
        selectedItemCreatedAt = itemId switch
        {
            1 => "January 15, 2024",
            2 => "March 22, 2024",
            3 => "June 10, 2024",
            4 => "December 5, 2023",
            5 => "December 7, 2024",
            _ => ""
        };
        
        selectedItemUpdatedAt = itemId switch
        {
            1 => "November 28, 2024",
            2 => "April 18, 2024",
            3 => "September 3, 2024",
            4 => "December 5, 2023",
            5 => "December 9, 2024",
            _ => ""
        };
    }
    
    private void ClosePanel()
    {
        isPanelOpen = false;
    }
    
    private void EditItem()
    {
        // TODO: Implement edit functionality
        Console.WriteLine($"Edit item {selectedItemId}");
    }
    
    private void DeleteItem()
    {
        // TODO: Implement delete confirmation and functionality
        Console.WriteLine($"Delete item {selectedItemId}");
    }
    
}
